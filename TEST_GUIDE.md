# 浏览脉络追踪器 - 测试指南

## 更新后的改进

### 1. 树形结构可视化增强
- ✅ 添加了垂直连接线，清晰显示父子关系
- ✅ 添加了横向连接线，连接节点与父节点
- ✅ 不同层级有不同的左边框颜色（蓝色渐变）
- ✅ 根节点有特殊高亮样式

### 2. 移除自动刷新
- ❌ 移除了每3秒的定时刷新
- ✅ 改为只在数据真正变化时更新
- ✅ 保留手动刷新按钮

### 3. UI优化
- ✅ 更现代的卡片式设计
- ✅ 悬停效果和过渡动画
- ✅ 更清晰的层级缩进
- ✅ 展开的子节点有视觉连接线

## 如何测试树形结构

### 测试步骤

1. **安装扩展**
   - 打开 `chrome://extensions/`
   - 加载已解压的扩展程序
   - 选择 `browse-tree-tracker` 文件夹

2. **创建测试场景**
   
   **场景一：简单跳转链**
   ```
   1. 打开扩展，点击 ➕ 创建新会话
   2. 在新标签页访问 https://www.zhihu.com
   3. 点击任意文章A
   4. 在文章A中点击链接跳转到文章B
   5. 在文章B中点击链接跳转到文章C
   6. 点击扩展图标，应该看到：
      
      🌐 知乎 (根节点)
      └── 📄 文章A
            └── 📄 文章B
                  └── 📄 文章C
   ```

   **场景二：分支跳转**
   ```
   1. 从知乎首页开始
   2. 点击文章A
   3. 从文章A返回知乎首页（点击后退）
   4. 点击文章B
   5. 应该看到：
   
      🌐 知乎
      ├── 📄 文章A
      └── 📄 文章B
   ```

   **场景三：深层嵌套**
   ```
   1. 访问维基百科 "计算机科学"
   2. 点击 "算法" 链接
   3. 点击 "排序算法" 链接
   4. 点击 "快速排序" 链接
   5. 应该看到深度为4的树形结构
   ```

### 预期效果

**树形连接线**：
```
│
├── 节点1  ← 横向连接线
│   │
│   ├── 子节点1.1  ← 缩进表示层级
│   │   │
│   │   └── 子节点1.1.1
│   │
│   └── 子节点1.2
│
└── 节点2
```

**实际UI效果**：
- 每个节点左侧有垂直的灰色连接线
- 子节点有额外的缩进和连接线
- 根节点有蓝色边框高亮
- 展开/折叠按钮可以控制子节点的显示

## 常见问题排查

### 问题1：还是看不到树形结构
**排查步骤**：
1. 打开扩展的 popup
2. 按 F12 打开开发者工具
3. 查看 Console 是否有错误
4. 检查 Elements 面板中 `.tree-node` 元素是否正确嵌套

### 问题2：跳转关系记录错误
**可能原因**：
- 某些网站使用SPA（单页应用）架构，URL不变但内容变化
- iframe 内的跳转不会被记录
- 刷新页面不会创建新节点

### 问题3：界面闪烁/刷新
**解决方案**：
- 已移除自动刷新
- 如需更新，点击刷新按钮 🔄
- 数据变化时自动更新

## 数据结构示例

```javascript
// 会话数据结构
{
  "session_xxx": {
    "id": "session_xxx",
    "name": "浏览会话 11月15日 14:30",
    "startTime": 1699999999999,
    "rootNodes": ["node_1", "node_5"],  // 多个起点
    "allNodes": {
      "node_1": {
        "id": "node_1",
        "url": "https://zhihu.com",
        "title": "知乎",
        "children": ["node_2"],  // 子节点ID数组
        "parentId": null,  // 根节点无父节点
        "visitCount": 1
      },
      "node_2": {
        "id": "node_2",
        "url": "https://zhihu.com/question/xxx",
        "title": "问题标题",
        "children": ["node_3"],
        "parentId": "node_1",  // 指向父节点
        "visitCount": 1
      }
      // ... 更多节点
    }
  }
}
```

## 调试信息

打开扩展后台页查看日志：
1. 访问 `chrome://extensions/`
2. 找到"浏览脉络追踪器"
3. 点击"背景页"或"Service Worker"
4. 在 Console 中查看 `[浏览脉络追踪器]` 开头的日志

日志示例：
```
[浏览脉络追踪器] 添加根节点: 知乎 - 如何学习编程？
[浏览脉络追踪器] 添加子节点: 算法导论 父节点: node_xxx
[浏览脉络追踪器] 更新已有子节点: 数据结构
```
